function checkProblemResponse(resultId) {
  const SpeechRecognition =
    window.SpeechRecognition || window.webkitSpeechRecognition;

  if (!SpeechRecognition) {
    alert("Speech Recognition not supported.");
    return;
  }

  const recognition = new SpeechRecognition();
  recognition.lang = "en-US";
  recognition.interimResults = false;

  const resultBox = document.getElementById(resultId);
  resultBox.innerHTML = "Listening...";

  recognition.start();

  recognition.onresult = (event) => {
    const spoken = normalise(event.results[0][0].transcript);
    const words = spoken.split(" ");

    let knownHTML = "<strong>Pronounced known words:</strong><br>";
    let unknownHTML = "<strong>Unfamiliar words:</strong><br>";

    words.forEach(word => {
      if (knownWords.includes(word)) {
        knownHTML += `<span class="word known">${word}</span>`;
      } else {
        unknownHTML += `<span class="word unknown">${word}</span>`;
      }
    });

    const isValid = problemPhrases.includes(spoken);

    resultBox.innerHTML = `
      <p><em>You said:</em> "${spoken}"</p>
      <p>
        ${isValid
          ? '<strong style="color: green;">✅ Appropriate customer response</strong>'
          : '<strong style="color: red;">❌ Not an appropriate response for this situation</strong>'
        }
      </p>
      ${knownHTML}<br>
      ${unknownHTML}
    `;
  };

  recognition.onerror = () => {
    resultBox.innerHTML = "Error recognising speech. Try again.";
  };
}
