<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WhatsApp-Style Interviewee Practice</title>

<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
    font-family: 'Nunito', Arial, sans-serif;
    padding: 20px;
    max-width: 700px;
    margin: auto;
    background: #e5ddd5;
}

h2 {
    text-align: center;
    color: #075e54;
    margin-bottom: 20px;
}

input[type=text] {
    width: 95%;
    padding: 10px;
    margin: 5px 0;
    border-radius: 12px;
    border: 1px solid #ccc;
    font-size: 16px;
}

button {
    padding: 10px 16px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    font-size: 15px;
    font-weight: 600;
    transition: transform 0.1s ease;
}

button:hover { transform: scale(1.05); }

.chat-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 20px;
    max-height: 500px;
    overflow-y: auto;
}

.message {
    max-width: 70%;
    padding: 12px;
    border-radius: 16px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    font-size: 16px;
    word-wrap: break-word;
}

.student {
    align-self: flex-end;
    background-color: #34b7f1;
    color: #fff;
    border-bottom-right-radius: 4px;
}

.computer {
    align-self: flex-start;
    background-color: #dcf8c6;
    color: #000;
    border-bottom-left-radius: 4px;
}

.start-btn {
    background-color: #ffca28;
    color: #fff;
    margin-left: 10px;
}

.feedback {
    display: block;
    margin-top: 6px;
    font-weight: bold;
    font-size: 14px;
}

.great { color: #43a047; }
.try { color: #e53935; }
</style>
</head>

<body>

<h2>🎤 WhatsApp-Style Interviewee Practice</h2>

<p>Enter the interview script (Interviewer → Interviewee → Interviewer → Interviewee):</p>

<div id="sentenceInputs">
  <input type="text" id="sentence0" placeholder="1. Interviewer question">
  <input type="text" id="sentence1" placeholder="2. Student answer">
  <br>
  <input type="text" id="sentence2" placeholder="3. Interviewer follow-up">
  <input type="text" id="sentence3" placeholder="4. Student answer">
</div>

<button onclick="addSentence()">+ Add Sentence</button>
<button style="background:#075e54;color:#fff" onclick="startDialog()">Start Interview</button>

<div id="chat" class="chat-container"></div>

<script>
// ---------------- UTILS ----------------
function levenshtein(a, b) {
  const dp = Array(a.length + 1).fill().map(() => Array(b.length + 1).fill(0));
  for (let i = 0; i <= a.length; i++) dp[i][0] = i;
  for (let j = 0; j <= b.length; j++) dp[0][j] = j;

  for (let i = 1; i <= a.length; i++) {
    for (let j = 1; j <= b.length; j++) {
      dp[i][j] = a[i - 1] === b[j - 1]
        ? dp[i - 1][j - 1]
        : Math.min(dp[i - 1][j], dp[i][j - 1], dp[i - 1][j - 1]) + 1;
    }
  }
  return dp[a.length][b.length];
}

function typeText(el, text, speed = 40) {
  el.textContent = "";
  let i = 0;
  const timer = setInterval(() => {
    el.textContent += text[i++];
    el.scrollIntoView({ behavior: "smooth" });
    if (i >= text.length) clearInterval(timer);
  }, speed);
}

// ---------------- STATE ----------------
let sentences = [];
let currentIndex = 0;
let sentenceCount = 4;

// ---------------- INPUT ----------------
function addSentence() {
  const box = document.getElementById("sentenceInputs");
  const input = document.createElement("input");
  input.type = "text";
  input.id = "sentence" + sentenceCount;
  input.placeholder = (sentenceCount + 1) + ". Next line";
  box.appendChild(document.createElement("br"));
  box.appendChild(input);
  sentenceCount++;
}

// ---------------- FLOW ----------------
function startDialog() {
  const chat = document.getElementById("chat");
  chat.innerHTML = "";
  sentences = [];

  for (let i = 0; i < sentenceCount; i++) {
    const val = document.getElementById("sentence" + i).value.trim();
    if (!val) return alert("Please fill all sentences.");
    sentences.push(val);
  }

  currentIndex = 0;
  showNext();
}

function showNext() {
  if (currentIndex >= sentences.length) return;
  const chat = document.getElementById("chat");

  // EVEN → Interviewer (computer)
  if (currentIndex % 2 === 0) {
    const div = document.createElement("div");
    div.className = "message computer";
    chat.appendChild(div);
    typeText(div, sentences[currentIndex]);
    currentIndex++;
    setTimeout(showNext, sentences[currentIndex - 1].length * 40 + 300);
  }

  // ODD → Interviewee (student speaks)
  else {
    const div = document.createElement("div");
    div.className = "message student";

    const text = document.createElement("span");
    text.textContent = sentences[currentIndex];

    const btn = document.createElement("button");
    btn.textContent = "🎧 Start Speaking";
    btn.className = "start-btn";

    div.appendChild(text);
    div.appendChild(btn);
    chat.appendChild(div);
    div.scrollIntoView({ behavior: "smooth" });

    btn.onclick = () => startSpeaking(sentences[currentIndex], div, btn);
  }
}

// ---------------- SPEECH ----------------
function startSpeaking(expected, bubble, btn) {
  btn.disabled = true;

  const feedback = document.createElement("span");
  feedback.className = "feedback";
  feedback.textContent = "🎤 Listening...";
  bubble.appendChild(feedback);

  const SpeechRec = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRec) {
    feedback.textContent = "Speech recognition not supported.";
    return;
  }

  const rec = new SpeechRec();
  rec.lang = "en-US";
  rec.interimResults = false;

  rec.onresult = e => {
    const spoken = e.results[0][0].transcript.toLowerCase().trim();
    const expectedClean = expected.toLowerCase().trim();
    const score = levenshtein(spoken, expectedClean);

    if (score <= 3) {
      bubble.innerHTML = expected;
      bubble.className = "message student";

      const ok = document.createElement("span");
      ok.textContent = "🌟 Great job!";
      ok.className = "feedback great";
      bubble.appendChild(ok);

      currentIndex++;
      showNext();
    } else {
      feedback.textContent = "⚠️ Try again!";
      feedback.className = "feedback try";
      btn.disabled = false;
    }
  };

  rec.onerror = e => feedback.textContent = "Error: " + e.error;
  rec.start();
}
</script>

</body>
</html>
