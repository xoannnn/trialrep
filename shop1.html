<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shopping Pronunciation Practice</title>

<style>
body{
  font-family:Arial,sans-serif;
  padding:30px;
  padding-bottom:90px;
  background:linear-gradient(to bottom,#87ceeb 0%,#87ceeb 50%,#228B22 50%,#228B22 100%);
  color:#222;
}

#activityContainer{max-width:600px;margin:auto}

h3{text-align:center;font-size:2em;color:#fff;text-shadow:2px 2px #000}

#itemButtons{
  display:flex;
  justify-content:center;
  gap:6px;
  overflow-x:auto;
  margin-bottom:16px;
}

button{
  padding:8px 14px;
  margin:6px;
  border:2px solid #000;
  border-radius:4px;
  background:#8B4513;
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}

.hidden{display:none}

.sentence{
  margin:12px 0;
  padding:12px 16px;
  background:#C2B280;
  border:2px solid #000;
  font-size:1.2em;
}

.speaker-b{text-align:right}

.resultBox{
  background:#d0e7ff;
  border:2px solid #000;
  padding:12px;
  margin-top:8px;
}

.listening{
  margin-left:8px;
  font-style:italic;
  color:#32CD32;
}

.resultButton{
  font-size:.9em;
  margin-right:4px;
  font-weight:bold;
}

.resultButton.correct{background:#4CAF50;color:#fff}
.resultButton.wrong{background:#f44336;color:#fff}

.feedback{
  font-weight:bold;
  margin-top:8px;
  font-size:1.2em;
}

.perfect{
  margin-top:10px;
  font-size:28px;
  font-weight:bold;
  color:gold;
  text-align:center;
  animation:pop .6s ease;
}

@keyframes pop{
  0%{transform:scale(.5);opacity:0}
  100%{transform:scale(1);opacity:1}
}

.bottom{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
}

#progressDisplay{
  position:fixed;
  top:20px;
  right:30px;
  font-size:1.4em;
  background:#6B8E23;
  padding:10px 20px;
  border:2px solid #000;
  color:#fff;
}
</style>
</head>

<body>

<div id="activityContainer">

<h3>Pronunciation Practice</h3>
<div id="itemButtons"></div>

<div id="step1" class="hidden">
  <p id="sentence1" class="sentence"></p>
  <button onclick="listenAndCheck(1)">Check</button>
  <span id="listening1" class="hidden listening">Listening…</span>
  <div id="result1" class="resultBox"></div>
  <div id="perfect1"></div>
</div>

<div id="step2" class="hidden">
  <p id="sentence2" class="sentence"></p>
  <button onclick="listenAndCheck(2)">Check</button>
  <span id="listening2" class="hidden listening">Listening…</span>
  <div id="result2" class="resultBox"></div>
  <div id="perfect2"></div>
</div>

<div id="step3" class="hidden">
  <p id="sentence3" class="sentence speaker-b"></p>
  <button onclick="listenAndCheck(3)">Check</button>
  <span id="listening3" class="hidden listening">Listening…</span>
  <div id="result3" class="resultBox"></div>
  <div id="perfect3"></div>
</div>

<div id="step4" class="hidden">
  <p id="sentence4" class="sentence"></p>
  <button onclick="listenAndCheck(4)">Check</button>
  <span id="listening4" class="hidden listening">Listening…</span>
  <div id="result4" class="resultBox"></div>
  <div id="perfect4"></div>
</div>

<div id="step5" class="hidden">
  <p id="sentence5" class="sentence"></p>
  <button onclick="listenAndCheck(5)">Check</button>
  <span id="listening5" class="hidden listening">Listening…</span>
  <div id="result5" class="resultBox"></div>
  <div id="perfect5"></div>
</div>

<div id="step6" class="hidden">
  <p id="sentence6" class="sentence speaker-b"></p>
  <button onclick="listenAndCheck(6)">Check</button>
  <span id="listening6" class="hidden listening">Listening…</span>
  <div id="result6" class="resultBox"></div>
  <div id="perfect6"></div>
</div>

<div id="step7" class="hidden">
  <p id="sentence7" class="sentence speaker-b"></p>
  <button onclick="listenAndCheck(7)">Check</button>
  <span id="listening7" class="hidden listening">Listening…</span>
  <div id="result7" class="resultBox"></div>
  <div id="perfect7"></div>
</div>

<div id="step8" class="hidden">
  <p id="sentence8" class="sentence"></p>
  <button onclick="listenAndCheck(8)">Check</button>
  <span id="listening8" class="hidden listening">Listening…</span>
  <div id="result8" class="resultBox"></div>
  <div id="perfect8"></div>
</div>

<div id="step9" class="hidden">
  <p id="sentence9" class="sentence"></p>
  <button onclick="listenAndCheck(9)">Check</button>
  <span id="listening9" class="hidden listening">Listening…</span>
  <div id="result9" class="resultBox"></div>
  <div id="perfect9"></div>
</div>

<div class="bottom">
  <button id="nextBtn" onclick="nextStep()">Next</button>
</div>

</div>

<div id="progressDisplay">Progress: 0 / 0</div>

<script>
const items={sneakers:"plural",pants:"plural",shorts:"plural",jacket:"singular",watch:"singular",bracelet:"singular"};
const itemEmojis={sneakers:"👟",pants:"👖",shorts:"🩳",jacket:"🧥",watch:"⌚",bracelet:"📿"};

let step=0,sentences={},currentItem=null,currentNumber=null;
const adjectives=["cool","colorful","cute","simple"];
const scorePerStep={};
let totalWordsForItem=0;

const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;
const recognition=new SpeechRecognition();
recognition.lang="en-US";

const itemButtons=document.getElementById("itemButtons");
for(let item in items){
  const btn=document.createElement("button");
  btn.textContent=item+" "+(itemEmojis[item]||"");
  btn.onclick=()=>start(item);
  itemButtons.appendChild(btn);
}

function start(item){
  currentItem=item;
  step=1;
  currentNumber=items[item];
  scoreReset();

  const d=currentNumber==="plural"?"These":"This";
  const v=currentNumber==="plural"?"are":"is";
  const p=currentNumber==="plural"?"them":"it";
  const fit=currentNumber==="plural"?"fit":"fits";
  const adj=adjectives[Math.floor(Math.random()*adjectives.length)];

  sentences={
    1:`${d} ${item} ${v} so ${adj}.`,
    2:`May I try ${p} on?`,
    3:`Sure.`,
    4:currentNumber==="plural"?"They are a little small for me.":"It is a little small for me.",
    5:currentNumber==="plural"?"May I try bigger ones?":"May I try a bigger one?",
    6:`Of course. Just a moment, please.`,
    7:currentNumber==="plural"?"How about these?":"How about this?",
    8:currentNumber==="plural"?`They ${fit} perfectly.`:`It ${fit} perfectly.`,
    9:`I'll take ${p}.`
  };

  totalWordsForItem=Object.values(sentences).reduce((s,a)=>s+a.split(" ").length,0);
  document.querySelectorAll('[id^="step"]').forEach(s=>s.classList.add("hidden"));
  showSentence(1);
  updateProgress();
}

function scoreReset(){
  for(let k in scorePerStep) delete scorePerStep[k];
}

function showSentence(n){
  document.getElementById(`sentence${n}`).textContent=sentences[n];
  document.getElementById(`step${n}`).classList.remove("hidden");
}

function cleanWord(w){
  return w.replace(/[.,!?;:']/g,"").toLowerCase();
}

function updateProgress(){
  const score=Object.values(scorePerStep).reduce((a,b)=>a+b,0);
  document.getElementById("progressDisplay").textContent=`Progress: ${score} / ${totalWordsForItem}`;
}

function listenAndCheck(stepNum){
  const listeningSpan=document.getElementById(`listening${stepNum}`);
  listeningSpan.classList.remove("hidden");

  recognition.start();

  recognition.onresult=e=>{
    const spoken=e.results[0][0].transcript.toLowerCase().split(" ");
    const words=sentences[stepNum].split(" ");
    const resultDiv=document.getElementById(`result${stepNum}`);
    const perfectDiv=document.getElementById(`perfect${stepNum}`);

    resultDiv.innerHTML="";
    perfectDiv.innerHTML="";

    let points=0;
    let allCorrect=true;

    words.forEach((word,i)=>{
      const btn=document.createElement("button");
      btn.disabled=true;
      btn.className="resultButton";

      if(cleanWord(spoken[i]||"")===cleanWord(word)){
        btn.textContent=word;
        btn.classList.add("correct");
        points++;
      }else{
        btn.textContent=spoken[i]||"[...]";
        btn.classList.add("wrong");
        allCorrect=false;
      }
      resultDiv.appendChild(btn);
    });

    scorePerStep[stepNum]=points;
    updateProgress();

    const feedback=document.createElement("div");
    feedback.className="feedback";
    feedback.style.color=allCorrect?"green":"red";
    feedback.textContent=allCorrect?"Great job!":"Try again!";
    resultDiv.appendChild(feedback);

    if(allCorrect) showPerfectScore(stepNum);
  };

  recognition.onend=()=>{
    listeningSpan.classList.add("hidden");
  };
}

function showPerfectScore(stepNum){
  const div=document.getElementById(`perfect${stepNum}`);
  div.textContent="✨ PERFECT! ✨";
  div.className="perfect";
}

function nextStep(){
  if(step<9){
    step++;
    showSentence(step);
  }
}
</script>

</body>
</html>