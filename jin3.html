<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ask me a question!</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #fdf6f0, #ffe6cc);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }

    #pageTitle {
      font-size: 36px;
      color: #ff8c42;
      margin-bottom: 30px;
      text-align: center;
    }

    #thumbnailCard {
      background: #ffd699;
      padding: 20px;
      border-radius: 25px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.3);
      display: inline-block;
      text-align: center;
    }

    #thumbnail {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s;
    }
    #thumbnail:hover { transform: scale(1.05); }
    #thumbnail img { width: 100%; height: 100%; object-fit: cover; }
    #thumbnailCard p { margin-top: 10px; font-size: 14px; color: #333; }

    #chatContainer {
      width: 420px;
      height: 600px;
      background-color: #fdf6f0;
      border-radius: 20px;
      display: none;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    #chatHeader {
      background-color: #ff8c42;
      color: white;
      padding: 15px;
      font-weight: bold;
      text-align: center;
      font-size: 20px;
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    #chatMessages {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      background-color: #fff0f5;
    }

    .message {
      max-width: 70%;
      padding: 10px 14px;
      border-radius: 20px;
      margin-bottom: 10px;
      word-wrap: break-word;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      animation: fadeIn 0.3s;
      font-size: 14px;
      line-height: 1.4;
    }

    @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }

    .studentMsg {
      background-color: #8fe388;
      color: #000;
      align-self: flex-end;
      border-bottom-right-radius: 5px;
    }

    .intervieweeMsg {
      background-color: #fff;
      border: 1px solid #ccc;
      align-self: flex-start;
      color: #000;
      border-bottom-left-radius: 5px;
    }

    #chatInputContainer {
      display: flex;
      flex-direction: column;
      padding: 10px;
      background: linear-gradient(145deg, #ffffff, #ffe6cc);
      border-top: 1px solid #ccc;
    }

    #chatTitle {
      margin-bottom: 5px;
      font-weight: bold;
      text-align: center;
      color: #333;
      font-size: 16px;
    }

    #chatInputRow { display: flex; }

    #chatInput {
      flex: 1;
      padding: 10px;
      border-radius: 25px;
      border: 1px solid #ccc;
      outline: none;
      font-size: 14px;
    }

    #micButton {
      background-color: #ff6f61;
      border: none;
      color: white;
      padding: 10px 14px;
      margin-left: 10px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 16px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      transition: background 0.2s;
    }

    #micButton:active { background-color: #ff4c3b; }
  </style>
</head>
<body>

  <div id="pageTitle">Ask me a question!</div>

  <div id="thumbnailCard">
    <div id="thumbnail">
      <!-- Character display picture, auto-cropped -->
      <img src="https://i.imgur.com/0Z8Vh9K.png" alt="Interviewee Thumbnail">
    </div>
    <p>Click the picture to start chatting</p>
  </div>

  <div id="chatContainer">
    <div id="chatHeader">Interview Practice</div>
    <div id="chatMessages"></div>
    <div id="chatInputContainer">
      <div id="chatTitle">Ask me a question.</div>
      <div id="chatInputRow">
        <input type="text" id="chatInput" placeholder="Type a question...">
        <button id="micButton">🎤</button>
      </div>
    </div>
  </div>

  <script>
    // ---------------------------
    // EXACT QA from your table
    // ---------------------------
    const qaData = {
      "Where did you live before?": "I lived in Spain, France, the Czech Republic, the Philippines, and Kazakhstan.",
      "What was Spain like?": "Spain is very sunny, and the people are really friendly. I like Spain a lot.",
      "When did you arrive in Japan?": "I arrived in Japan last year, in July.",
      "What did you do before?": "I was working and studying in Spain.",
      "What did you enjoy doing?": "I liked going to the beach, meeting my friends, and travelling to other countries.",
      "What was your favourite subject at school?": "My favourite subject was Physics.",
      "What did you like to do after school?": "I liked playing video games and meeting my friends.",
      "What sport did you play before?": "I played soccer, and now I play squash and pickleball.",
      "What food did you like when you were younger?": "I really liked fried chicken.",
      "Did you live in another country before?": "Yes, I lived in Spain, Italy, France, Kazakhstan, the Czech Republic, and the Philippines.",
      "Where are you from?": "I am from the Philippines.",
      "Which is your favourite city?": "My favourite city is Prague.",
      "What do you like about Japan?": "I love Japanese food.",
      "What do you not like about Japan?": "Kanji is very difficult for me.",
      "What is your favourite place in Japan?": "My favourite place in Japan is Kyoto.",
      "What do you like about your job?": "I like seeing my students every day.",
      "What is difficult in your job?": "Reading kanji is very difficult for me.",
      "What do you enjoy doing now?": "I enjoy playing sports and cooking different dishes.",
      "What are your hobbies?": "I like cooking, travelling, playing video games, meeting my friends, studying languages, running, playing squash, and watching TV shows.",
      "What is your favourite food?": "My favourite foods are fried chicken, paella, and katsu curry.",
      "What is your favourite band?": "My favourite band is Coldplay.",
      "Do you have any brothers or sisters?": "I have one sister.",
      "What do you do on the weekend?": "I meet up with my friends, watch concerts, play sports, and go biking around Matsubara.",
      "What games do you like to play?": "I like playing Valorant, God of War, Final Fantasy, etc.",
      "Who do you live with?": "I live alone.",
      "What is your favourite place to relax?": "I like relaxing in cafés.",
      "Why did you come to Japan?": "I want to learn Japanese, and living in Japan was my childhood dream.",
      "Where do you want to go?": "I want to travel to Africa and South America.",
      "What country do you want to visit?": "I want to go to Russia.",
      "What do you want to do?": "I want to improve my Japanese.",
      "Why do you want to do that?": "I want to talk to more people.",
      "What do you want to learn next?": "I want to learn how to play the violin.",
      "Where do you want to live in the future?": "I want to live in China.",
      "What job do you want to try?": "I want to be a firefighter.",
      "What do you want to do this year?": "I want to learn karate or naginata."
    };

    const inappropriateKeywords = ['sex','fuck','bitch','shit','damn','ass','idiot'];

    const thumbnail = document.getElementById('thumbnail');
    const chatContainer = document.getElementById('chatContainer');
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const micButton = document.getElementById('micButton');

    thumbnail.addEventListener('click', ()=> chatContainer.style.display='flex');

    function addMessage(text,type){
      const msgDiv = document.createElement('div');
      msgDiv.className = 'message ' + (type==='student'?'studentMsg':'intervieweeMsg');
      msgDiv.innerText = text;
      chatMessages.appendChild(msgDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function typeAnswer(answer){
      const msgDiv = document.createElement('div');
      msgDiv.className = 'message intervieweeMsg';
      chatMessages.appendChild(msgDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      let i=0;
      const interval = setInterval(()=>{
        msgDiv.innerText = answer.substring(0,i+1);
        i++;
        chatMessages.scrollTop = chatMessages.scrollHeight;
        if(i>=answer.length) clearInterval(interval);
      },25); // adjust speed here
    }

    // ---------------------------
    // STRICT FUZZY MATCHING
    // ---------------------------
    function findAnswer(input){
      input = input.trim().toLowerCase().replace(/[?.!]/g,''); // remove punctuation

      // inappropriate words
      for(let word of inappropriateKeywords){
        if(input.includes(word)) return "Please ask a proper interview question.";
      }

      // exact match first
      for(const question in qaData){
        const normalizedQuestion = question.toLowerCase().replace(/[?.!]/g,'');
        if(input === normalizedQuestion) return qaData[question];
      }

      // strict fuzzy match
      for(const question in qaData){
        const normalizedQuestion = question.toLowerCase().replace(/[?.!]/g,'');
        const qWords = normalizedQuestion.split(' ').filter(w => w.length > 2);
        const inputWords = input.split(' ').filter(w => w.length > 2);

        // all words in stored question must exist in input
        const allWordsMatch = qWords.every(w => inputWords.includes(w));
        if(allWordsMatch) return qaData[question];
      }

      return "I’m not sure I understood, can you repeat?";
    }

    chatInput.addEventListener('keypress',(e)=>{
      if(e.key==='Enter' && chatInput.value.trim()!==''){
        const question = chatInput.value.trim();
        addMessage(question,'student');
        chatInput.value='';
        setTimeout(()=>{
          const answer = findAnswer(question);
          typeAnswer(answer);
        },500+Math.random()*1000);
      }
    });

    micButton.addEventListener('click', ()=>{
      if(!('webkitSpeechRecognition' in window)){
        alert('Speech Recognition not supported in this browser.');
        return;
      }
      const recognition = new webkitSpeechRecognition();
      recognition.lang='en-US';
      recognition.interimResults=false;
      recognition.maxAlternatives=1;
      recognition.start();
      recognition.onresult=(event)=>{
        const speechText = event.results[0][0].transcript;
        addMessage(speechText,'student');
        setTimeout(()=>{
          const answer = findAnswer(speechText);
          typeAnswer(answer);
        },500+Math.random()*1000);
      };
    });

  </script>
</body>
</html>s